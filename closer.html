console.log("Panel closer cargado");

// ðŸ”¹ Obtener ID del usuario logueado
const userId = localStorage.getItem("usuario_id");

// Si no existe, fuera
if (!userId) {
  localStorage.clear();
  window.location.href = "login.html";
}

// ðŸ”¹ FunciÃ³n que valida si el usuario sigue activo
async function checkSession() {

  try {

    const res = await fetch(
      `https://stripe-backend-h1z1.vercel.app/api/login?user_id=${userId}`
    );

    if (!res.ok) {
      forceLogout();
      return;
    }

    const data = await res.json();

    if (!data.active) {
      forceLogout();
    }

  } catch {
    // Si falla el servidor, no hacemos logout automÃ¡tico
    // para evitar cierres por error de red
  }
}

// ðŸ”¹ Forzar cierre de sesiÃ³n
function forceLogout() {
  localStorage.clear();
  alert("Tu cuenta ha sido desactivada por el administrador.");
  window.location.href = "login.html";
}

// ðŸ”¹ Comprobar cada 5 segundos
setInterval(checkSession, 5000);

// ðŸ”¹ Comprobar tambiÃ©n al cargar
checkSession();